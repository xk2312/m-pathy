@import "tailwindcss";
@import "../styles/design.tokens.css";  /* ⬅︎ Urgroßeltern: zentrale Tokens */

/* Chat-typografische Erweiterung (für .md-prose) */
@import "../styles/chat-prose.css";
/* syntax theme for rehype-highlight */
@import "highlight.js/styles/github-dark.css";

/* ── Base Reset ───────────────────────────────────────────── */
* { box-sizing: border-box; margin: 0; padding: 0; }

/* Wichtig: Scroll wieder erlauben + Selektieren aktivieren */
html, body {
  width: 100%;
  /* ⬇︎ Hart auf Viewport-Höhe + KEIN globales Scrollen */
  height: 100dvh;            /* statt nur min-height */
  color: #fff;
  background:
    radial-gradient(circle at center, #0f0f0f, #000000);
  user-select: text;
  -webkit-user-select: text;
  touch-action: pan-y pinch-zoom;
}

/* Scroll-Freigabe nur wenn explizit gesetzt */
html.enable-scroll {
  overflow-y: auto !important;
}
/* ⬇︎ Beim Entsperren auch overscroll wieder erlauben (hebt body:contain auf) */
html.enable-scroll,
html.enable-scroll body {
  overscroll-behavior-y: auto !important;
}

html {
  overflow-x: hidden;
  overflow-y: hidden;        /* ⬅︎ Body/Seite scrollt NICHT */
}

body {
  background-color: #000;
  overscroll-behavior-y: contain; /* optional restriktiver */
  -webkit-tap-highlight-color: transparent;
}


/* Canvas bleibt block-level */
canvas { display: block; }

/* ── Legacy Bloom-IDs: beibehalten ───────────────────────── */
#bloom-wrapper { position: relative; width: 100%; min-height: 100dvh; }
#bloom-core {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 160px; height: 160px; border-radius: 50%;
  background: rgba(112,224,255,0.05);
  transition: all 0.3s ease; z-index: 2;
}
#bloom-core.hover { box-shadow: 0 0 60px rgba(112,224,255,0.4); }
.stage-2 { background: black; transition: background 1s ease; }

/* ── Keyframes (global, stabil) ──────────────────────────── */
@keyframes zenithSweep {
  from { transform: translateX(-120%); }
  to   { transform: translateX(120%); }
}
@keyframes zenithExit {
  0%   { opacity:1; transform: translateX(-50%) translateY(0) scale(1); filter: blur(0); }
  40%  { opacity:.9; transform: translateX(-50%) translateY(-3vh) scale(1.04); }
  100% { opacity:0; transform: translateX(-50%) translateY(-20vh) scale(.9); filter: blur(6px); }
}
@keyframes zenithDust {
  0%   { opacity:.9; transform: translate(0,0) scale(1); filter: blur(0); }
  100% { opacity:0; transform: translate(var(--dx), var(--dy)) scale(0.3); filter: blur(2px); }
}
@media (prefers-reduced-motion: reduce){
  * { animation: none !important; transition: none !important; transform: none !important; }
  html { scroll-behavior: auto !important; } /* kein smooth scroll bei RRM */
}
/* ── Chat-Farben (wie bei dir) ───────────────────────────── */
.message { color: #fff; }
.message.user { color: #0ff; }
.message.assistant { color: #ffd700; }

/* ── Scrollbars (dezent) ─────────────────────────────────── */
section::-webkit-scrollbar { width: 8px; }
section::-webkit-scrollbar-track { background: transparent; }
section::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }
section::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

/* --- KPI scope: leichte Entzerrung der Tabellenzeilen --- */
.kpi-scope {
  line-height: 1.35;               /* sanfte Auflockerung */
}
.kpi-scope table tr > th,
.kpi-scope table tr > td {
  padding-block: 6px;              /* etwas Luft oben/unten */
}


/* ── Hilfsklassen ────────────────────────────────────────── */
/* Falls du lokal selektieren verbieten willst: */
.no-copy { user-select: none !important; -webkit-user-select: none !important; }

/* z-Layer Konvention (für Overlays/Drawer/FAB) */
:root {
  --dock-h: 60px; /* fallback dock height */
  /* --- Safe-area Desktop Default --- */
  --safe-bottom: 0px; /* Desktop-Fallback; @supports block aktualisiert diesen Wert */
}


/* Wenn der Browser safe-area kennt, mappe sie auf die Variable. */
@supports (padding: max(0px)) {
  :root {
    --safe-bottom: env(safe-area-inset-bottom, 0px);
  }
}


/* ======================================================================
   Markdown typographic defaults (greifen auf <div class="markdown">…)
   ====================================================================== */

.markdown {
  line-height: 1.6;
  word-break: break-word;
  color: inherit;           /* erbt Bubble-Farbe */
}

/* Headings */
.markdown h1,
.markdown h2,
.markdown h3 {
  margin: 1.2em 0 0.6em;
  font-weight: 700;
  line-height: 1.25;
}
.markdown h1 { font-size: clamp(1.40rem, 1.10rem + 1vw, 1.90rem); }
.markdown h2 { font-size: clamp(1.25rem, 1.00rem + 0.7vw, 1.60rem); }
.markdown h3 { font-size: clamp(1.10rem, 0.95rem + 0.5vw, 1.30rem); }

/* Paragraphs */
.markdown p { margin: 0.75em 0; }

/* Lists */
.markdown ul,
.markdown ol {
  display: block;           /* Schutz gegen Resets */
  list-style-position: outside;
  margin: 0.75em 0 0.75em 1.25em;
  padding: 0;
}
.markdown li { display: list-item; margin: 0.25em 0; }
.markdown ul  { list-style-type: disc; }
.markdown ul ul { margin-left: 1.1em; list-style-type: circle; }
.markdown ol  { list-style-type: decimal; }

/* Inline code */
.markdown code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: 0.9em;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 0.1em 0.35em;
  border-radius: 0.35em;
}

/* Links (optional) */
.markdown a { text-decoration: underline; color: inherit; }

/* === MOBILE SCOPE ===================================================== */
@media (max-width: 768px), (pointer: coarse) {
  :root {
    /* Viewport + Safe Area (werden später via JS aktualisiert) */
    --vh: 1vh;                         /* Fallback, wird via visualViewport gesetzt */
    --safe-bottom: env(safe-area-inset-bottom, 0px);

    /* Header-Höhen */
    --header-h-idle: 96px;
    --header-h-shrink: 72px;
    --header-h-typing: 0px;
    --header-h: var(--header-h-idle);  /* aktueller Wert (wird getoggelt) */

    /* Dock / Prompt Caps */
    --dock-cap-portrait: 30vh;
    --dock-cap-landscape: 22vh;
    --dock-cap: var(--dock-cap-portrait);

    /* Spacings */
    --header-offset: 16px;             /* Säule-Offset unter Header */
  }

  /* Motion budget mobil (respect RRM) */
  @media (prefers-reduced-motion: no-preference) {
    .mob-transition {
      transition: height .16s ease, padding .16s ease, transform .16s ease, opacity .16s ease;
    }
  }
}
/* === Mobile MessageInput Toolbar Toggle ================================ */
@media (max-width: 768px), (pointer: coarse) {
  /* Plus-Button mobil zeigen */
  .mi-plus-btn { display: inline-flex; }

  /* Rechte Icon-Leiste mobil ausblenden (nur die Toolbar, nicht den Senden-Button) */
  .m-inputbar__actionsRight [role="toolbar"] {
    display: none !important;
  }

  /* Tool-Kacheln im Popover: große Touch-Ziele */
  .mi-tool {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 44px;
    border-radius: 10px;
    border: 1px solid #314156;
    background: #0b1220;
    color: #e6f0f3;
    font-weight: 700;
  }
}

/* Desktop: Plus-Button ausblenden */
@media (min-width: 769px) and (pointer: fine) {
  .mi-plus-btn { display: none !important; }
}
/* === A11y Focus Enhancements =========================================== */
:focus-visible {
  outline: 2px solid rgba(34,211,238,0.55);
  outline-offset: 2px;
}
/* (removed duplicate :root --dock-h; now defined in main :root) */
@media (max-width: 768px){
  html, body { overflow-x: hidden; }
}


/* gezielt den Chat-Scroller dunkler stylen */
div[data-convo="1"]::-webkit-scrollbar-track { background: transparent; }
@supports (scrollbar-color: auto) {
  div[data-convo="1"] { scrollbar-color: rgba(255,255,255,0.25) transparent; }
}

/* Golden Prompt Layout */
.gold-tools{
  display:flex; gap:8px; justify-content:flex-start;
  width:min(920px, 100%); margin:0 auto 6px auto;
}
.gt{
  height:32px; min-width:32px; border-radius:10px;
  border:1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.04);
  color: inherit;
}
.gold-prompt-wrap{
  display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:stretch;
  width:min(920px, calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right) - 16px));
  margin:0 auto;
}
.gold-textarea{
  width:100%; min-height:44px; max-height:var(--dock-cap); resize:none;
  border-radius:12px; padding:10px 12px; line-height:1.5;
  border:1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.04); color: inherit; outline:none;
}
.gold-send{
  min-height:44px; align-self:stretch; border-radius:12px;
  padding:0 14px; font-weight:700; cursor:pointer;
  border:1px solid rgba(34,211,238,0.28); background: rgba(34,211,238,0.12); color: inherit;
}

/* Inertias & Ripple (wie besprochen) */
.gold-dock.send-ripple{
  animation: gp-inertia 320ms cubic-bezier(.2,.6,.2,1) 1,
             gp-ripple 680ms ease-out 1;
}
@keyframes gp-inertia{
  0%{ transform: translateY(0); } 55%{ transform: translateY(-3px); } 100%{ transform: translateY(0); }
}
@keyframes gp-ripple{
  0%{ box-shadow: 0 -6px 24px rgba(0,0,0,.35), inset 0 0 0 0 rgba(34,211,238,0); }
  15%{ box-shadow: 0 -6px 24px rgba(0,0,0,.35), inset 0 0 0 1000px rgba(34,211,238,0.08); }
  100%{ box-shadow: 0 -6px 24px rgba(0,0,0,.35), inset 0 0 0 0 rgba(34,211,238,0); }
}
/* Reserviere immer Fußraum im rechten Scroll-Container 
div[data-convo="1"] {
  padding-bottom: calc(var(--dock-h, 60px) + var(--safe-bottom, 0px) + 24px);
}
*/
/* Dock zuverlässig an den Viewport pinnen (Desktop & Mobile) – Single source */
#m-input-dock {
  position: fixed;
  left: 0;
  right: 0;
  bottom: var(--safe-bottom, 0px);
  z-index: var(--z-overlay, 90);
}

/* ---------- Markdown scope ---------- */
.md {
  /* sorgt für angenehme Breite im Bubble-Layout, ohne Seitenlayout zu verändern */
  word-wrap: break-word;
  overflow-wrap: anywhere;
  line-height: 1.55;
}

/* ---------- Tables ---------- */
/* Apply to BOTH .md and .markdown (alias) */
.md .md-table-wrap,
.markdown .md-table-wrap {
  overflow-x: auto;
  margin: 10px 0 14px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
}

.md table,
.markdown table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
}

.md th, .md td,
.markdown th, .markdown td {
  padding: 10px 12px;
  text-align: left;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  vertical-align: top;
}

.md thead th,
.markdown thead th {
  font-weight: 700;
  background: rgba(255,255,255,0.04);
  position: sticky;
  top: 0;
  z-index: 1;
}

.md tbody tr:nth-child(even) td,
.markdown tbody tr:nth-child(even) td {
  background: rgba(255,255,255,0.02);
}

/* runde Ecken an der Außenkante */
.md table tr:first-child th:first-child,
.markdown table tr:first-child th:first-child { border-top-left-radius: 10px; }

.md table tr:first-child th:last-child,
.markdown table tr:first-child th:last-child  { border-top-right-radius: 10px; }

.md table tr:last-child  td:first-child,
.markdown table tr:last-child  td:first-child { border-bottom-left-radius: 10px; }

.md table tr:last-child  td:last-child,
.markdown table tr:last-child  td:last-child  { border-bottom-right-radius: 10px; }

/* ---------- Code: fenced blocks ---------- */
.md .md-code {
  margin: 12px 0;
  padding: 14px 16px;
  border-radius: 12px;
  /* Farbe vom Bubble-Kontext übernehmen */
  color: inherit;
  background: rgba(15,23,42,0.66); /* glassy slate */
  background-clip: padding-box;
  border: 1px solid rgba(255,255,255,0.10);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
}

.md .md-code > code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size: 14px;
  line-height: 1.6;
  tab-size: 2;
  white-space: pre;
  color: inherit; /* Syntax-Theme färbt Tokens; Grundfarbe bleibt vom Bubble-Kontext */
}

/* ---------- Code: inline ---------- */
.md .md-inline {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size: 0.92em;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 8px;
  padding: 0.1em 0.45em;
  white-space: break-spaces; /* wrappt in Bubbles elegant */
}

/* ---------- Links im Markdown ---------- */
.md a {
  color: #76eaff;
  text-decoration: none;
  border-bottom: 1px solid rgba(118,234,255,0.35);
}
.md a:hover { filter: brightness(1.1); }

/* ---------- Lists spacing ---------- */
.md ul, .md ol { padding-left: 1.25em; margin: 8px 0 12px; }
.md li + li    { margin-top: 4px; }

/* === GPTM: Table Mobile Fallback (no wrapper needed) === */
/* On narrow screens, allow inline scroll for tables that were not wrapped. */
@media (max-width: 768px) {
  .md table,
  .markdown table {
    display: block;              /* enable overflow on the element itself */
    overflow-x: auto;            /* horizontal scroll */
    -webkit-overflow-scrolling: touch;
    width: 100%;
  }

  /* keep cells readable when narrow; you may remove if wrapping is preferred */
   .md table th, .md table td,
  .markdown table th, .markdown table td {
    white-space: nowrap;         /* prevent ugly multi-line cell breaks */
  }
}
/* =====================================================================
   ⬇️ GalaxyBuilder Patch · KPI Centering & Row Density (v1.1)
   Purpose: Zentriert Elterncontainer & lockert KPI-Zeilen spacing
   ===================================================================== */

/* Eltern-Pattern: erzwingt Mitte & Innenabstand über Tokens */
.page-center {
  box-sizing: border-box;
  width: 100%;
  max-width: var(--page-inner-max);
  margin-inline: auto;
  padding-inline: var(--page-pad-inline);
}

/* KPI-scope: sanft lockerere Zeilen, ohne globale Nebenwirkung */
.kpi-scope {
  line-height: 1.35;
}

.kpi-scope table tr > th,
.kpi-scope table tr > td {
  padding-block: 6px; /* leichtes vertikales Luftpolster */
}
/* --- KPI scope: header spacing + tabs breathing room --- */
.kpi-scope thead th {
  line-height: 1.45;
  padding-block: 10px;     /* Kopfzeilen spürbar luftiger */
}

.kpi-scope [role="tablist"] {
  margin-block: 10px;      /* Abstand oberhalb/unterhalb der Tabs */
}

.kpi-scope [role="tab"] {
  padding-block: 10px;     /* Tab-Schaltflächen mit vertikaler Luft */
}
/* --- KPI scope: guard against 100vw/overflow in children --- */
.kpi-scope > * {
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;    /* keine übergroße Kindbreite */
}
/* --- KPI scope: fine-tune tabs + first column padding --- */
.kpi-scope [role="tablist"] {
  margin-top: 5px;
  margin-bottom: 5px;
}

.kpi-scope [role="tab"] {
  padding-top: 5px;
  padding-bottom: 5px;
}

.kpi-scope table tr > *:first-child {
  padding-left: 5px;
}
/* --- KPI scope: column symmetry + label indentation --- */

/* gleiche Innenabstände links und rechts in allen Zellen */
.kpi-scope table tr > *:first-child {
  padding-left: 5px;
}
.kpi-scope table tr > *:last-child {
  padding-right: 5px;
}

/* Überschriften und Abschnittstitel (Core, Core · Tabelle usw.) leicht eingerückt */
.kpi-scope h2,
.kpi-scope h3 {
  padding-left: 10px;
}

/* Falls "Core · ..." Text in custom Spans/Divs sitzt */
.kpi-scope [class*="Core"],
.kpi-scope [class*="core"] {
  padding-left: 10px;
}
/* --- KPI scope: button inner padding adjustment --- */
.kpi-scope button {
  padding-left: 20px !important;  /* vorher px-4 → 16px, jetzt +4px ≈ +5px visuell */
  padding-right: 20px !important;
}
/* KPI scope: enforce pointer on all actionable controls */
.kpi-scope button,
.kpi-scope [role="tab"],
.kpi-scope [role="button"],
.kpi-scope a {
  cursor: pointer;
}
/* Tabs dürfen immer Events bekommen und über Randkanten liegen */
.kpi-scope [role="tablist"] { pointer-events: auto; position: relative; z-index: 2; }
.kpi-scope [role="tab"] { pointer-events: auto; }
/* --- KPI scope: spacing between bullet and section title --- */
.kpi-scope h3 span.rounded-full {
  margin-right: 5px;
}

/* falls CardTitle andere Überschrift nutzt (Fallback) */
.kpi-scope .card-title span.rounded-full {
  margin-right: 5px;
}

/* =====================================================================
   End of Patch · Council13 verified · Triketon-2048 Seal
   ===================================================================== */
/* Point Zero · Desktop Center Guard for /subscription */
@media (min-width: 1024px) {
  .subscription-root {
    margin-inline: auto !important;
    max-width: var(--page-max) !important;
    display: block;
  }
}
.kpi-scope {
  width: 110%;
  max-width: none;
  margin-inline: -5%;
}
